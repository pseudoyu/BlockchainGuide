## 区块链安全

### 风险来源

**应用层**

- 与应用程序相关的攻击和安全问题，如数字货币交易所

**智能合约层**

- 很多潜在风险，如DAO事件

**激励层**

- 矿工付出成本 > 奖励，则去中心化系统可能崩溃

**共识层**

- Bribe Attack
- Long-Range Attack
- Coin age Accumulation Attack
- Precomputing Attack
- Sybil Attack

**网络层**

- BGP hijacking: 大约60%的比特币流量是通过几个互联网服务提供商，这些互联网服务提供商可以轻松控制和查看流量

**数据层**

- 恶意信息攻击（区块链上数据不可变）

### 区块链风险分类

- 51%攻击 - 共识机制
- 私钥安全 - 加密方案
- 违法行为 - 数字货币应用
- 双重花费 - 验证机制
- 信息传输隐私泄漏 - 交易方案设计缺陷
- 恶意智能合约 - 智能合约应用
- 智能合约漏洞 - 智能合约开发缺陷
- 智能合约执行优化 - 程序执行缺陷
- 低成本操作 - EVM设计缺陷

### 风险分析

1. 协议
2. 加密方案
3. 应用
4. 程序开发
5. 系统

以太坊智能合约漏洞

- Solidity 编程语言
- EVM 以太坊虚拟机
- Blockchain 区块链


### 著名安全事件

- Youbit
- Bitfinex
    - DDoS攻击
- ICO攻击
    - 对ICO钱包地址进行攻击
- Mt. Gox事件
    - 占据70%比特币交易
    - US$450M比特币被盗
    - 利用了比特币transaction malleability
- DAO事件
    - 一个众筹智能合约应用
    - 利用了Solidity语言的脆弱性

### Transaction Malleability攻击概述

1. 每一笔交易都被数字签名
2. 创建Hash作为交易ID
3. 在早期的实现中，对于padding数据没有严格标准，hash创建使用<$,form, to, padding string>
4. 攻击者可以改变padding字符串从而改变交易ID
5. 攻击者要求交易所转出1美元
6. 交易所会通知攻击者关于交易ID
7. 攻击者更改ID，存入金额，并声明交易丢失，欺骗交易所重新发送

### 智能合约安全

E.g. 低成本攻击

- 基础
    - 智能合约
    - 以太坊Gas机制
        - 收取用户执行合约费用，以避免智能合约占用大量计算资源
        - 每个操作都分配有特定的Gas单位
        - 用户可以指定每单位Gas的数量和限额
        - 执行智能合约代码的矿工获得Gas费用
- 攻击思路
    - 识别较低Gas费的操作
    - 重复执行
- 实例
    - EXTCODESIZE
    - SUICIDE

更通用的安全解决方案

- 构建一个自动检查器来检查代码以识别恶意代码